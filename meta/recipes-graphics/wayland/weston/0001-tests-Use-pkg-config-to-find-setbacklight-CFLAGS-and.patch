From 99d6d5c8741bd6f4574eca8973879be89afd24b8 Mon Sep 17 00:00:00 2001
From: Damien Lespiau <damien.lespiau@intel.com>
Date: Wed, 25 Jul 2012 11:58:59 +0100
Subject: [PATCH] tests: Use pkg-config to find setbacklight CFLAGS and libs

---
 configure.ac      |    1 +
 tests/Makefile.am |    3 ++-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/configure.ac b/configure.ac
index 231a024..2d49993 100644
--- a/configure.ac
+++ b/configure.ac
@@ -224,6 +224,7 @@ fi
 AC_CHECK_PROG(RSVG_CONVERT, rsvg-convert, rsvg-convert)
 AM_CONDITIONAL(HAVE_RSVG_CONVERT, test -n "$RSVG_CONVERT")
 
+PKG_CHECK_MODULES(SETBACKLIGHT, [libudev libdrm])
 
 if test "x$GCC" = "xyes"; then
 	my_common_gcc_flags="-Wall -Wextra -Wno-unused-parameter \
diff --git a/tests/Makefile.am b/tests/Makefile.am
index b788977..1f5514f 100644
--- a/tests/Makefile.am
+++ b/tests/Makefile.am
@@ -35,6 +35,7 @@ setbacklight_SOURCES =				\
 	$(top_srcdir)/src/libbacklight.c	\
 	$(top_srcdir)/src/libbacklight.h
 
-setbacklight_LDADD = -ludev -ldrm
+setbacklight_CFLAGS = $(AM_CFLAGS) $(SETBACKLIGHT_CFLAGS)
+setbacklight_LDADD = $(SETBACKLIGHT_LIBS)
 
 EXTRA_DIST = weston-test
-- 
1.7.10.4

